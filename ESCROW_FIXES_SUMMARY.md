# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å —ç—Å–∫—Ä–æ—É-–ø–ª–∞—Ç–µ–∂–∞–º–∏

## –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:

### 1. ‚ùå "buffer is not defined" –æ—à–∏–±–∫–∞
**–ü—Ä–æ–±–ª–µ–º–∞**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `Buffer` API, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –≤ –±—Ä–∞—É–∑–µ—Ä–µ  
**–†–µ—à–µ–Ω–∏–µ**: –ó–∞–º–µ–Ω–µ–Ω –Ω–∞ `TextEncoder` API –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Å—Ç—Ä–æ–∫ –≤ –±–∞–π—Ç—ã

**–ë—ã–ª–æ:**
```javascript
const idBytes = `0x${Buffer.from(orderId)
  .toString("hex")
  .slice(0, 64)
  .padEnd(64, "0")}`;
```

**–°—Ç–∞–ª–æ:**
```javascript
const encoder = new TextEncoder();
const data = encoder.encode(orderId);
const idBytes = `0x${Array.from(data)
  .map(b => b.toString(16).padStart(2, '0'))
  .join('')
  .slice(0, 64)
  .padEnd(64, "0")}`;
```

### 2. ‚ùå –î–≤–µ –∫–Ω–æ–ø–∫–∏ "Release funds" 
**–ü—Ä–æ–±–ª–µ–º–∞**: –ë—ã–ª–∏ –¥–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- `onReleaseFunds` (–±–æ–ª–µ–µ –ø–æ–ª–Ω–∞—è)
- `onRelease` (–¥—É–±–ª–∏–∫–∞—Ç)

**–†–µ—à–µ–Ω–∏–µ**: –£–¥–∞–ª–µ–Ω –¥—É–±–ª–∏–∫–∞—Ç `onRelease`, –æ—Å—Ç–∞–≤–ª–µ–Ω —Ç–æ–ª—å–∫–æ `onReleaseFunds`

### 3. ‚ùå –û—à–∏–±–∫–∞ –≤—ã–ø—É—Å–∫–∞ —Å—Ä–µ–¥—Å—Ç–≤ 
**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏:
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Ç–µ–∫—É—â–∏–π –∫–æ—à–µ–ª–µ–∫ = –ø–æ–∫—É–ø–∞—Ç–µ–ª—å
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å "Pending")  
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –Ω–∞ —Ä—É—Å—Å–∫–æ–º
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–∞—Ç–µ–∂–∞ –¥–æ –∏ –ø–æ—Å–ª–µ –≤—ã–ø—É—Å–∫–∞

### 4. ‚úÖ –£–ª—É—á—à–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è "Check Status"
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞ (None/Pending/Released/Refunded)
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–¥—Ä–µ—Å –ø–æ–∫—É–ø–∞—Ç–µ–ª—è vs –≤–∞—à —Ç–µ–∫—É—â–∏–π –∞–¥—Ä–µ—Å
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–æ–∂–µ—Ç–µ –ª–∏ –≤—ã –≤—ã–ø—É—Å—Ç–∏—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞ ("–î–ê"/"–ù–ï–¢")
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—É–º–º—É –ø–ª–∞—Ç–µ–∂–∞

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å —ç—Å–∫—Ä–æ—É-–ø–ª–∞—Ç–µ–∂
1. –ù–∞–∂–∞—Ç—å "Pay to ESCROW"
2. –í–≤–µ—Å—Ç–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 0x000...dEaD)
3. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å approve –≤ MetaMask
4. –°–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç–µ–∂

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å  
1. –ù–∞–∂–∞—Ç—å "Check Status"
2. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Å—Ç–∞—Ç—É—Å = "Pending"
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –º–æ–∂–µ—Ç–µ –≤—ã–ø—É—Å—Ç–∏—Ç—å = "–î–ê"

### –®–∞–≥ 3: –í—ã–ø—É—Å—Ç–∏—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞
1. –ù–∞–∂–∞—Ç—å "Release Funds" 
2. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤ MetaMask
3. –°—Ä–µ–¥—Å—Ç–≤–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—Å—è: 40% –ø–∞—Ä—Ç–Ω–µ—Ä—É, 40% –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ, 20% –≥–æ—Ä–æ–¥—É

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

‚úÖ `Buffer is not defined` –±–æ–ª—å—à–µ –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è  
‚úÖ –¢–æ–ª—å–∫–æ –æ–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞ "Release Funds"  
‚úÖ –ö–Ω–æ–ø–∫–∞ "Check Status" —Ä–∞–±–æ—Ç–∞–µ—Ç  
‚úÖ –î–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö  
‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ –≤—ã–ø—É—Å–∫–æ–º  
‚úÖ –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É "Check Status"

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:

–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤ `src/crypto.js` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∞–¥—Ä–µ—Å–∞:
```javascript
escrow: {
  address: "0x24Ea4392CDC8cB4e80dE6c45D9D1b66Ad0f24292",
  platformTreasury: "0x5Fa6460D804d2833f302a58DEbef946C6B108Ba3", // ‚úÖ –í–∞—à –∞–¥—Ä–µ—Å
  cityTreasury: "0x5d26F935646b4A48E1bFC74328e6875F6eD0afA7", // ‚úÖ –ì–æ—Ä–æ–¥
},
```

–¢–µ–ø–µ—Ä—å –≤—Å—ë –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ! üéâ
